{% extends "page.html" %}

{% block styles %}
{{ super() }}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
<style>
    .profile-card {
        background: white;
        border-radius: 12px;
        padding: 25px;
        margin-bottom: 25px;
        box-shadow: 0 2px 15px rgba(0, 0, 0, 0.08);
        position: relative;
    }

    .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 25px;
        margin-top: 25px;
    }

    .detail-item {
        padding: 15px 0;
        border-bottom: 1px solid #eee;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .profile-card .info-grid .detail-item:last-child {
        border-bottom: none;
        /* Ensures no bottom border for the last item within each profile card */
    }

    .detail-label {
        font-weight: 500;
        color: #666;
        flex: 1;
        /* Adjust this if necessary to reduce the gap */
        margin-right: 10px;
        /* You can adjust this to manage the space between the label and the value */
    }

    .detail-value {
        flex-grow: 1;
        color: #333;
        text-align: left;
        /* This aligns the text to the left, ensuring no large gap on the right */
    }

    .profile-card .info-grid .detail-item:last-child {
        border-bottom: none;
        /* Ensures no bottom border for the last item */
    }

    .status-button {
        position: absolute;
        top: 20px;
        /* Adjust based on your needs */
        right: 20px;
        /* Adjust based on your needs */
        padding: 7px 20px;
        color: white;
        border: none;
        border-radius: 20px;
        cursor: pointer;
    }

    .status-true {
        background-color: #28a745;
        /* Green for active */
    }

    .status-false {
        background-color: #dc3545;
        /* Red for inactive */
    }

    .alt-name-list {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-top: 10px;
    }

    .alt-name-item {
        background: #f3f4f6;
        padding: 6px 15px;
        border-radius: 20px;
        font-size: 0.9em;
    }

    .download-section {
        text-align: center;
        padding: 40px 20px;
    }

    .btn-download {
        background: linear-gradient(135deg, #0b7a8b, #17a2b8);
        color: white;
        padding: 12px 35px;
        border-radius: 30px;
        border: none;
        font-size: 1.1em;
        transition: transform 0.2s ease;
    }

    .btn-download:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(11, 122, 139, 0.3);
    }
</style>
{% endblock %}

{% block content %}
<div class="regx-container">
    {% include "side_nav.html" %}
    <div class="container">
        <div class="profile-card">
            <h1>{{ company.company_name }}</h1>

        </div>
        <div class="profile-card">
            <h4 class="mb-4">Company Details</h4>
            <div class="info-grid">
                <div class="detail-item">
                    <span class="detail-label" style="font-weight: bold;">Official Email:</span>
                    <span class="detail-value">{{ company.email_address }}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label" style="font-weight: bold;">Website:</span>
                    <a class="detail-value website-link" id="website-link" href="{{ company.website }}"> {{
                        company.website }}</a>
                </div>
                <div class="detail-item">
                    <span class="detail-label" style="font-weight: bold;">Created Date:</span>
                    <span class="detail-value">{{ company.created }}</span>
                </div>
                <button class="status-button {{ 'status-true' if company['status'] else 'status-false' }}">
                    {{ 'Active' if company['status'] else 'Inactive' }}
                </button>
            </div>
        </div>

        <div class="profile-card">
            <h4 class="mb-4">Alternative Names</h4>
            <div class="alt-name-list">
                <!-- Dynamic alternative names would go here -->
                <div class="alt-name-list">
                    {% for name in company['alternative_names'] %}
                    <span class="alt-name-item">{{ name }}</span>
                    {% endfor %}
                </div>
            </div>
        </div>

        <div class="profile-card">
            <h4 class="mb-4">Claimant Information</h4>
            <div class="info-grid">
                <div class="detail-item">
                    <span class="detail-label" style="font-weight: bold;">Claimant Email:</span>
                    <span class="detail-value">{{ company.claimant }}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label" style="font-weight: bold;">Claimant Role:</span>
                    <span class="detail-value">{{ company.claimant_role }}</span>
                </div>
            </div>
        </div>

        <div class="profile-card">
            <h4 class="mb-4">Company Address</h4>
            <div class="info-grid">
                <div class="detail-item">
                    <span class="detail-label" style="font-weight: bold;">Address:</span>
                    <span class="detail-value">{{ company.company_address }}</span>
                </div>
            </div>
        </div>

        <div class="download-section">
            <button class="btn-download" onclick="downloadDataset({{ company.id}})">
                <i class="fas fa-download me-2"></i>Download Dataset
            </button>
        </div>
    </div>
</div>

<script>
    function downloadDataset(companyId) {
        window.location.href = `/regx/download_dataset/${companyId}`;
    }
    function ensureHttps(url) {
        if (!url) return url; // Handle empty URLs
        if (!url.startsWith('http://') && !url.startsWith('https://')) {
            return `https://${url}`;
        }
        return url.replace('http://', 'https://');
    }

    // Function to update website links
    function updateWebsiteLinks() {
        const websiteLinks = document.querySelectorAll('.website-link');
        websiteLinks.forEach(link => {
            link.href = ensureHttps(link.href);
            link.textContent = ensureHttps(link.textContent);
        });
    }
    // Observe changes to the search results container
    const observer = new MutationObserver((mutationsList) => {
        for (const mutation of mutationsList) {
            if (mutation.type === 'childList') {
                // Search results have been updated
                updateWebsiteLinks();
            }
        }
    });

    // Start observing the search results container
    const searchResultsContainer = document.getElementById('search-results-container');
    if (searchResultsContainer) {
        observer.observe(searchResultsContainer, { childList: true });
    }

    // Run on initial page load (in case there are pre-loaded results)
    document.addEventListener('DOMContentLoaded', updateWebsiteLinks);
</script>
{% endblock %}